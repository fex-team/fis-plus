<h3 class="" id="打包合并"><a name="%E6%89%93%E5%8C%85%E5%90%88%E5%B9%B6" class="anchor" href="#%E6%89%93%E5%8C%85%E5%90%88%E5%B9%B6"><span class="octicon octicon-link"></span></a>打包合并</h3><blockquote>
<p>FIS-Plus 提供静态资源管理系统，支持通过运行时计算静态资源使用情况来加载对应的静态资源。为了达到合理的高性能的加载方式，用户可以将静态资源进行合并。</p>
</blockquote>
<h4 class=""><a name="%E9%85%8D%E7%BD%AE" class="anchor" href="#%E9%85%8D%E7%BD%AE"><span class="octicon octicon-link"></span></a>配置</h4><p>用户可以在配置文件中，通过配置将静态资源进行合并处理，对 demo-home 模块增加打包配置：</p>
<pre><code class="hljs lang-javascript"><span class="xml">//fis-conf.js
fis.config.set('pack', </span><span class="hljs-expression">{
        /<span class="hljs-end-block">/ </span>打包所有 <span class="hljs-variable">static</span> 目录下的 <span class="hljs-variable">JS</span> 文件
        '<span class="hljs-variable">pkg</span><span class="hljs-end-block">/aio.js</span>' : /^\<span class="hljs-end-block">/static</span>\/(<span class="hljs-variable">.</span>*\<span class="hljs-variable">.js</span>)$<span class="hljs-end-block">/i</span>,
        '<span class="hljs-variable">pkg</span><span class="hljs-end-block">/widget.js</span>' : [/^\<span class="hljs-end-block">/widget</span>\<span class="hljs-end-block">/ui</span>\/(<span class="hljs-variable">.</span>*\<span class="hljs-variable">.js</span>)$<span class="hljs-end-block">/i</span>,
            '<span class="hljs-end-block">/widget</span><span class="hljs-end-block">/menu</span><span class="hljs-end-block">/menu.js</span>'
        ],
        /<span class="hljs-end-block">/ </span>打包所有的 <span class="hljs-variable">css</span> 文件
        /<span class="hljs-end-block">/ </span>将内容输出为 <span class="hljs-variable">static</span><span class="hljs-end-block">/pkg</span><span class="hljs-end-block">/aio.css </span>文件
        '<span class="hljs-variable">pkg</span><span class="hljs-end-block">/aio.css</span>' : '**<span class="hljs-variable">.css</span>'
}</span><span class="xml">);</span>
</code></pre>
<p>打包配置支持正则、字符串以及通配符，用户可灵活根据自己需求进行资源打包，同时注意以下打包细节：</p>
<ul>
<li>每个包只对应 js 或 css 类型，请误将其他非同类文件配置合并至包内，特别是使用通配符配置时，请注意目录下是否有其他非同类型文件</li>
<li>使用正则配置时需要添加定界符，不然将会达不到用户配置预期</li>
</ul>
<p>输出结果：使用命令 fis release <strong>--pack</strong> --md5 --dest ./output 编译项目，然后到 output 目录下查看产出的 home-map.json 内容.fis 内置的 <a href="https://github.com/fis-dev/fis/wiki/ 运行原理 #----1">打包原理</a> 与传统的打包概念不同，fis 的打包实际上是在建立一个资源表，并将其描述并产出为一份 map.json 文件，用户应该围绕着这份描述文件来设计前后端运行框架，从而实现运行时判断打包输出策略的架构。</p>
<h4 class=""><a name="%E6%89%93%E5%8C%85%E7%AD%96%E7%95%A5" class="anchor" href="#%E6%89%93%E5%8C%85%E7%AD%96%E7%95%A5"><span class="octicon octicon-link"></span></a>打包策略</h4><ul>
<li>每个资源包之间不会有重复资源，合并处理包时会根据配置节点顺序，将资源合并至资源包中。</li>
<li>根据资源包配置的匹配规则，进行资源顺序排序。</li>
<li>每个资源包中的静态资源，会根据文件之间的依赖关系进行自动排序。</li>
</ul>
<h4 class=""><a name="%E5%9F%BA%E6%9C%AC%E6%89%93%E5%8C%85%E5%8E%9F%E5%88%99" class="anchor" href="#%E5%9F%BA%E6%9C%AC%E6%89%93%E5%8C%85%E5%8E%9F%E5%88%99"><span class="octicon octicon-link"></span></a>基本打包原则</h4><ul>
<li>根据静态资源复用率情况，可将复用率较高的可合并在一起，复用率较低的可合并一起，同时可根据使用情况对静态资源不进行打包。</li>
<li>在 common 模块中，可以根据其他业务模块使用 common 资源情况进行打包，将复用高的资源合并打包，将个别模块使用的资源独立打包。</li>
<li>需要独立加载的 JS 组件资源，可不合并在包中，运行时会自动按需加载。</li>
<li>对匹配成功的资源会合并进资源包中，同时其依赖的资源会记录在资源表中，如果需要加载资源包时，会先加载依赖的文件。</li>
</ul>
<h4 class=""><a name="%E8%87%AA%E5%8A%A8%E6%89%93%E5%8C%85" class="anchor" href="#%E8%87%AA%E5%8A%A8%E6%89%93%E5%8C%85"><span class="octicon octicon-link"></span></a>自动打包</h4><p>手工维护资源打包工作存在未能及时排除废弃资源、需持续维护、成本大等缺陷。针对此问题，FIS 提供静态资源自动合并服务自动生成资源打包配置，根据网站页面 pv 以及页面静态资源使用情况，<code>自动计算静态资源合并方案，减少人工管理静态资源成本和风险</code>。</p>
<p>自动打包使用方式与现有一致，接入简单。提供简版和高端版两个版本：</p>
<ul>
<li>简版：只需安装一个插件便可使用自动打包。在编译过程中扫描模块代码分析资源依赖，提供页面级别的打包配置，支持重点页面权重等配置</li>
<li>高端版：基于线上资源统计计算整站最优打包方案，支持国际化等复杂使用场景。</li>
</ul>
<p>具体使用可以进入官网查看 <a href="http://solar.baidu.com/autopack/doc">此文档</a></p>
